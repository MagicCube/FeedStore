$ns("fsa");$import("lib.jquery.jquery-transit");$import("fsa.biz.ChannelManager");$import("fsa.scn.ChannelScene");$include("fsa.res.app.css");$include("fsa.res.NavigationBar.css");
fsa.App=function(){var b=$extend(mx.app.Application),f={};b.appId="fsa";b.appDisplayName="FeedStore Manager";f.init=b.init;b.init=function(a){f.init(a);b.scene=new fsa.scn.ChannelScene;b.addSubview(b.scene,b.$element.find("#body > #contentPannel"))};b.setLoading=function(a){null==a&&(a=!0);b.$element.toggleClass("loading",a)};b.run=function(){b.scene.activate({reload:!0})};return b.endOfClass(arguments)};$ns("fsa.biz");fsa.biz.ChannelManagerClass=function(){return $extend(MXComponent).endOfClass(arguments)};fsa.biz.ChannelManager=new fsa.biz.ChannelManagerClass;$ns("fsa.scn");$import("fsa.view.ChannelGridView");fsa.scn.ChannelScene=function(){var b=$extend(mx.scn.Scene);b.autoFillParent=!0;var f={};b.gridView=null;f.init=b.init;b.init=function(a){f.init(a);b.gridView=new fsa.view.ChannelGridView({id:"channelGridView",frame:{left:15,top:15,right:15,bottom:15}});b.addSubview(b.gridView)};f.activate=b.activate;b.activate=function(a){f.activate(a);null!=a&&a.reload&&b.gridView.load()};return b.endOfClass(arguments)};$ns("fsa.scn");$ns("fsa.view");$include("fsa.res.ChannelGridView.css");
fsa.view.ChannelGridView=function(){function b(e){a.sort(e.target.id)}function f(e){if("lastUpdatedTime"==e.target.id){fsa.app.setLoading();var d=e.target.parentNode.id;$(e.target).text("\u6b63\u5728\u66f4\u65b0...");$.ajax({method:"post",url:"/api/channel/"+d+"/update"}).success(function(d){fsa.app.setLoading(!1);null!=d?a.renderItem(d):$(e.target).text("\u5931\u8d25")}).error(function(){fsa.app.setLoading(!1);$(e.target).text("\u5931\u8d25")})}}var a=$extend(mx.view.View);a.elementClass="ChannelGridView";
var i={};a.columns=[{id:"title",text:"\u6807\u9898"},{id:"lastPublishTime",text:"\u6700\u540e\u53d1\u5e03\u65f6\u95f4"},{id:"lastStoredTime",text:"\u6700\u540e\u5b58\u50a8\u65f6\u95f4"},{id:"lastUpdatedTime",text:"\u6700\u540e\u66f4\u65b0\u65f6\u95f4"}];a.items=[];a.$headerRow=null;a.$tbody=null;i.init=a.init;a.init=function(e){i.init(e);for(var e=$("<table id=header><tr></tr></table>"),d=e.find("tr"),h=0;h<a.columns.length;h++){var c=a.columns[h],g=$("<td/>");g.attr("id",c.id);g.text(c.text);d.append(g)}d.on("click",
"td",b);a.$headerRow=d;a.$element.append(e);e=$("<table id=body><tbody></table>");d=$("<div id='bodyContainer'>");d.append(e);a.$element.append(d);a.$tbody=e.children("tbody");a.$tbody.on("click","td",f)};a.appendItem=function(e){var d=$("<tr>");d.attr("id",e.id);for(var b=0;b<a.columns.length;b++){var c=a.columns[b],g=$("<td/>");g.attr("id",c.id);a.formatCell(g,e[c.id],c);d.append(g)}a.$tbody.append(d);a.items.add(e)};a.renderItem=function(e){for(var d=a.$tbody.children("#"+e.id),b=0;b<a.columns.length;b++){var c=
a.columns[b],g=d.children("#"+c.id);a.formatCell(g,e[c.id],c)}};a.appendItems=function(b){for(var d=0;d<b.length;d++)a.appendItem(b[d])};a.clearItems=function(){a.items=[];a.$tbody.children().remove()};a.setItems=function(b){a.clearItems();a.appendItems(b)};a.load=function(){fsa.app.setLoading();$.ajax({url:$mappath("~/api/channel")}).done(function(b){fsa.app.setLoading(!1);a.setItems(b)})};_tomorrow=$format(Date.today.addDays(1),"yyyy\u5e74M\u6708d\u65e5");_today=$format(Date.today,"yyyy\u5e74M\u6708d\u65e5");
_yesterday=$format(Date.today.addDays(-1),"yyyy\u5e74M\u6708d\u65e5");_theDayBeforeYesterday=$format(Date.today.addDays(-2),"yyyy\u5e74M\u6708d\u65e5");a.formatCell=function(a,b,f){var c=null;"title"==f.id?c=null!=b?b:"":null!=b?(b=new Date(b),c=(new Date-b)/1E3,30>=c?c="\u521a\u521a":30<c&&3600>c?c=$format(b,"smart"):(c=$format(b,"yyyy\u5e74M\u6708d\u65e5 HH:mm"),c=c.replace(_today,"\u4eca\u5929"),c=c.replace(_yesterday,"\u6628\u5929"),c=c.replace(_tomorrow,"\u660e\u5929"),c=c.replace(_theDayBeforeYesterday,
"\u524d\u5929"),c=c.replace(Date.today.getFullYear()+"\u5e74","")),a.attr("title",$format(b))):c="";a.text(c)};a.sort=function(b){var d=a.items.sort(function(a,c){var d=a[b],f=c[b];return null==d?null==f?0:1:isFunction(d.localeCompare)?d.localeCompare(f):f-d});a.setItems(d)};return a.endOfClass(arguments)};